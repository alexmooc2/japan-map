<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Japan Trip">
  <title>üóæ Japan Trip</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow: hidden; }
    #map { width: 100vw; height: 100vh; }

    /* ‚îÄ‚îÄ Filter bar ‚îÄ‚îÄ */
    #filters {
      position: fixed;
      top: env(safe-area-inset-top, 12px);
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      display: flex;
      gap: 6px;
      background: rgba(255,255,255,0.95);
      padding: 8px 12px;
      border-radius: 24px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow-x: auto;
      max-width: calc(100vw - 32px);
      scrollbar-width: none;
    }
    #filters::-webkit-scrollbar { display: none; }

    .filter-btn {
      padding: 6px 14px;
      border: none;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: transparent;
      color: #555;
      white-space: nowrap;
      transition: all 0.15s;
    }
    .filter-btn.active {
      background: #1a73e8;
      color: white;
    }

    /* ‚îÄ‚îÄ My location button ‚îÄ‚îÄ */
    #locate-btn {
      position: fixed;
      bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
      right: 16px;
      z-index: 100;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      border: none;
      background: white;
      box-shadow: 0 2px 16px rgba(0,0,0,0.22);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ‚îÄ‚îÄ Info window ‚îÄ‚îÄ */
    .iw {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-width: 240px;
      max-width: 300px;
      padding: 2px 0 4px;
    }
    .iw-name {
      font-size: 17px;
      font-weight: 700;
      color: #111;
      line-height: 1.2;
      margin-bottom: 2px;
    }
    .iw-sub {
      font-size: 12px;
      color: #888;
      margin-bottom: 10px;
    }
    .iw-row {
      font-size: 13px;
      color: #333;
      margin-bottom: 5px;
      line-height: 1.4;
    }
    .iw-row b { color: #111; }
    .iw-btns {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-top: 12px;
    }
    .iw-btns-row {
      display: flex;
      gap: 7px;
    }
    .iw-btn {
      flex: 1;
      padding: 9px 6px;
      border: none;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      display: block;
      line-height: 1;
    }
    .iw-btn-gmaps  { background: #1a73e8; color: white; }
    .iw-btn-amaps  { background: #000; color: white; }
    .iw-btn-source { background: #f1f3f4; color: #333; }
  </style>
</head>
<body>
  <div id="filters">
    <button class="filter-btn active" onclick="filterCity('all')">All</button>
  </div>
  <div id="map"></div>
  <button id="locate-btn" onclick="locateMe()" title="My location">üìç</button>

  <script>
  const PLACES = [
  {
    "name": "Convenience Store (Kyoto)",
    "type": "Shop",
    "category": "Convenience Store",
    "city": "Kyoto",
    "area": "",
    "what_to_do": "Morning breakfast and snacks",
    "best_for": "Quick morning routine",
    "price_range": "$",
    "notes": "",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJZ2aaz68IAWARn_y6pPpk454",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.9882911,
    "lng": 135.7609218
  },
  {
    "name": "Kyoto Station",
    "type": "Attraction",
    "category": "Train Station",
    "city": "Kyoto",
    "area": "",
    "what_to_do": "Take the vintage train to Nara",
    "best_for": "Transportation hub",
    "price_range": "",
    "notes": "",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Kyoto%20Station&query_place_id=ChIJ7wKLka4IAWARCByidG5EGrY",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.985849,
    "lng": 135.7587667
  },
  {
    "name": "Nara",
    "type": "Attraction",
    "category": "Day Trip Destination",
    "city": "Nara",
    "area": "",
    "what_to_do": "Feed crackers to the deer",
    "best_for": "Deer interaction, day trip from Kyoto",
    "price_range": "$",
    "notes": "Accessible via vintage train from Kyoto Station",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Nara&query_place_id=ChIJwQyneMU3AWARIiZJubDZ_ko",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.685109,
    "lng": 135.8048019
  },
  {
    "name": "Uji",
    "type": "Neighborhood",
    "category": "Day Trip Destination",
    "city": "Uji",
    "area": "",
    "what_to_do": "See fall foliage and drink matcha",
    "best_for": "Matcha lovers, autumn foliage",
    "price_range": "",
    "notes": "Famous for matcha; accessible by train from Kyoto",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJ7VMo54QRAWAR3t1BYKpGatY",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.8845134,
    "lng": 135.7997037
  },
  {
    "name": "Fushimi Inari Taisha",
    "type": "Attraction",
    "category": "Shrine",
    "city": "Kyoto",
    "area": "Fushimi",
    "what_to_do": "Walk through the torii gate pathway",
    "best_for": "Iconic photos, hiking",
    "price_range": "",
    "notes": "",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJIW0uPRUPAWAR6eI6dRzKGns",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.9676945,
    "lng": 135.7791876
  },
  {
    "name": "Arashiyama Bamboo Grove",
    "type": "Attraction",
    "category": "Natural Attraction",
    "city": "Kyoto",
    "area": "Arashiyama",
    "what_to_do": "Walk through the bamboo grove",
    "best_for": "Nature walks, photography",
    "price_range": "",
    "notes": "",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Arashiyama%20Bamboo%20Forest&query_place_id=ChIJrYtcv-urAWAR3XzWvXv8n_s",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 35.0168187,
    "lng": 135.6713013
  },
  {
    "name": "Arashiyama",
    "type": "Neighborhood",
    "category": "District",
    "city": "Kyoto",
    "area": "Arashiyama",
    "what_to_do": "Spend an afternoon exploring",
    "best_for": "Half-day or full-day trip",
    "price_range": "",
    "notes": "",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJ49PvUVQHAWARTAF7WU_Wqqs",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 35.009449,
    "lng": 135.666773
  },
  {
    "name": "Myokura Kyoto",
    "type": "Hotel",
    "category": "Hotel",
    "city": "Kyoto",
    "area": "Kyoto Station",
    "what_to_do": "Stay overnight",
    "best_for": "Convenient location near station",
    "price_range": "",
    "notes": "Located right by Kyoto Station",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=MIMARU%20KYOTO%20STATION&query_place_id=ChIJSa6Rd7IIAWAR0VNhyWD2uMw",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 34.9829717,
    "lng": 135.7618725
  },
  {
    "name": "Hakone",
    "type": "Attraction",
    "category": "Day Trip Destination",
    "city": "Hakone",
    "area": "",
    "what_to_do": "Visit via Shinkansen from Kyoto",
    "best_for": "Onsen, scenic views, Mt. Fuji",
    "price_range": "",
    "notes": "Accessible by Shinkansen from Kyoto",
    "uploader": "gabbbyle",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Hakone&query_place_id=ChIJe9yyYAyiGWARJnuXrBe9BSY",
    "source_url": "https://www.tiktok.com/@gabbbyle/video/7589188920894704926?_r=1&_t=ZT-947fO5bnM8T",
    "lat": 35.2337691,
    "lng": 139.1088454
  },
  {
    "name": "Kushikatsu Daruma",
    "type": "Restaurant",
    "category": "Kushikatsu",
    "city": "Osaka",
    "area": "Dotonbori",
    "what_to_do": "Eat kushikatsu (deep-fried skewers)",
    "best_for": "Classic Osaka street food experience",
    "price_range": "$$",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Kushikatsu%20Daruma%20-%20Dotombori&query_place_id=ChIJ2YfF7RTnAGARvwILJIgrP7c",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.6688351,
    "lng": 135.502638
  },
  {
    "name": "Umeda Sky Building",
    "type": "Attraction",
    "category": "Observation Deck",
    "city": "Osaka",
    "area": "Umeda",
    "what_to_do": "Visit the observation deck for city views",
    "best_for": "City views, sightseeing",
    "price_range": "",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Umeda%20Sky%20Building&query_place_id=ChIJbyd0kIjmAGAR_crecCbjwlc",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.7052872,
    "lng": 135.4896527
  },
  {
    "name": "Isaribi",
    "type": "Restaurant",
    "category": "Robatayaki",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Have robatayaki dinner (Japanese charcoal grill)",
    "best_for": "Dinner experience",
    "price_range": "$$",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Isaribi&query_place_id=ChIJVQPrz5HmAGAR-eFwrHI8hLs",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.7064892,
    "lng": 135.4977256
  },
  {
    "name": "neel",
    "type": "Cafe",
    "category": "Cafe",
    "city": "Osaka",
    "area": "Nakazakicho",
    "what_to_do": "",
    "best_for": "Cafe hopping in trendy neighborhood",
    "price_range": "",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=neel%20nakazakicho&query_place_id=ChIJGyLAvWrnAGARgV8FAkqNJfk",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.7087745,
    "lng": 135.5034573
  },
  {
    "name": "Universal Studios Japan",
    "type": "Attraction",
    "category": "Theme Park",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Visit the theme park",
    "best_for": "Full day entertainment, families, Harry Potter fans",
    "price_range": "$$$",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJXeLVg9DgAGARqlIyMCX-BTY",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.6656768,
    "lng": 135.4323185
  },
  {
    "name": "Salon de AManTo",
    "type": "Cafe",
    "category": "Cafe",
    "city": "Osaka",
    "area": "",
    "what_to_do": "",
    "best_for": "Unique cafe experience",
    "price_range": "",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Salon%20de%20AManTo&query_place_id=ChIJzUwQeZbmAGARoYXgxwJkjdA",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.7080705,
    "lng": 135.5043988
  },
  {
    "name": "Tsutaya Books Hirakata",
    "type": "Shop",
    "category": "Bookstore",
    "city": "Osaka",
    "area": "Hirakata",
    "what_to_do": "Browse books and lifestyle goods",
    "best_for": "Book lovers, design enthusiasts",
    "price_range": "",
    "notes": "",
    "uploader": "",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Tsutaya%20Books%20Hirakata&query_place_id=ChIJZek-cVAcAWARVFe0gnysw1E",
    "source_url": "https://www.instagram.com/p/DRvpfchknVD/?igsh=NTc4MTIwNjQ2YQ==",
    "lat": 34.81606,
    "lng": 135.64957
  },
  {
    "name": "Osaka Castle",
    "type": "Attraction",
    "category": "Castle",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Visit the historic castle",
    "best_for": "history lovers, sightseeing",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Osaka%20Castle&query_place_id=ChIJ_TooXM3gAGARQR6hXH3QAQ8",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6872571,
    "lng": 135.5258546
  },
  {
    "name": "Dotonbori River",
    "type": "Attraction",
    "category": "Landmark",
    "city": "Osaka",
    "area": "Dotonbori",
    "what_to_do": "See the Glico Running Man advertisement",
    "best_for": "iconic photo spot, nightlife area",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Dotonbori&query_place_id=ChIJg2DcJhXnAGARCbeAHoZrPeQ",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6686471,
    "lng": 135.5030983
  },
  {
    "name": "Universal Studios Japan",
    "type": "Attraction",
    "category": "Theme Park",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Visit the theme park",
    "best_for": "families, theme park fans",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Universal%20Studios%20Japan&query_place_id=ChIJXeLVg9DgAGARqlIyMCX-BTY",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6656768,
    "lng": 135.4323185
  },
  {
    "name": "Umeda Sky Building",
    "type": "Attraction",
    "category": "Observation Deck",
    "city": "Osaka",
    "area": "Umeda",
    "what_to_do": "Visit the observation deck",
    "best_for": "city views, architecture",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Umeda%20Sky%20Building&query_place_id=ChIJbyd0kIjmAGAR_crecCbjwlc",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.7052872,
    "lng": 135.4896527
  },
  {
    "name": "Grand Green Osaka Park",
    "type": "Attraction",
    "category": "Park",
    "city": "Osaka",
    "area": "Umeda",
    "what_to_do": "Visit the park",
    "best_for": "relaxation, walking",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/place/?q=place_id:ChIJ5w4wcADnAGARt7Rj38hGYWk",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.7024579,
    "lng": 135.4913958
  },
  {
    "name": "Abeno Harukas",
    "type": "Attraction",
    "category": "Skyscraper",
    "city": "Osaka",
    "area": "Abeno",
    "what_to_do": "Visit Japan's tallest skyscraper",
    "best_for": "city views, shopping",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Abeno%20Harukas&query_place_id=ChIJed3mI_DdAGARJyFcpACSbwc",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6460706,
    "lng": 135.5134771
  },
  {
    "name": "Pok√©mon Caf√© Osaka",
    "type": "Cafe",
    "category": "Themed Cafe",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Dine at the Pok√©mon-themed cafe",
    "best_for": "Pok√©mon fans, unique dining experience",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Pok%C3%A9mon%20Cafe%20Osaka%20Shinsaibashi&query_place_id=ChIJ97lN2RDnAGARxxH5he8b6KQ",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6733012,
    "lng": 135.5007844
  },
  {
    "name": "Minoh Waterfall",
    "type": "Attraction",
    "category": "Waterfall",
    "city": "Osaka",
    "area": "Minoh",
    "what_to_do": "See the waterfall and autumn foliage",
    "best_for": "nature lovers, autumn foliage viewing",
    "price_range": "",
    "notes": "Nice foliage in early December",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Minoh%20Falls&query_place_id=ChIJE8YKbYz5AGARoCiDnK6410w",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.8538281,
    "lng": 135.4719911
  },
  {
    "name": "Kaiyukan Aquarium",
    "type": "Attraction",
    "category": "Aquarium",
    "city": "Osaka",
    "area": "",
    "what_to_do": "Visit the aquarium",
    "best_for": "families, marine life enthusiasts",
    "price_range": "",
    "notes": "",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Osaka%20Aquarium%20Kaiyukan&query_place_id=ChIJzakNjPToAGARzCwIriDFg28",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6545182,
    "lng": 135.4289645
  },
  {
    "name": "Denden Town",
    "type": "Neighborhood",
    "category": "Electronics District",
    "city": "Osaka",
    "area": "Nipponbashi",
    "what_to_do": "Shop for electronics, anime goods, and otaku culture items",
    "best_for": "anime fans, electronics shopping",
    "price_range": "",
    "notes": "Described as a smaller version of Akihabara",
    "uploader": "fujirin",
    "maps_url": "https://www.google.com/maps/search/?api=1&query=Nipponbashi%20Denden%20Town&query_place_id=ChIJv6w_-2fnAGARH2p9wbwos3c",
    "source_url": "https://www.reddit.com/r/JapanTravelTips/comments/1fph5j5/what_is_a_must_do_in_osaka/loxwohu/",
    "lat": 34.6604299,
    "lng": 135.5058817
  }
];

  // Category colour palette ‚Äî keyed on the broad Type field
  const TYPE_COLORS = {
    'Restaurant':  '#e8453c',  // red
    'Cafe':        '#795548',  // brown
    'Bar':         '#7b1fa2',  // purple
    'Shop':        '#00897b',  // teal
    'Market':      '#43a047',  // green
    'Attraction':  '#1e88e5',  // blue
    'Hotel':       '#3949ab',  // indigo
    'Service':     '#fb8c00',  // orange
    'Neighborhood':'#546e7a',  // blue-grey
    'Other':       '#78909c',  // grey
  };
  function typeColor(type) {
    return TYPE_COLORS[type] || '#78909c';
  }

  // Legend labels for the info window subtitle
  const TYPE_ICONS = {
    'Restaurant':  'üçΩÔ∏è',
    'Cafe':        '‚òï',
    'Bar':         'üç∏',
    'Shop':        'üõçÔ∏è',
    'Market':      'üè™',
    'Attraction':  'üèõÔ∏è',
    'Hotel':       'üè®',
    'Service':     'üîß',
    'Neighborhood':'üìç',
    'Other':       'üìå',
  };

  let map, infoWindow, markers = [];

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 6,
      center: { lat: 35.5, lng: 136.5 },
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: false,
      zoomControl: true,
      zoomControlOptions: { position: google.maps.ControlPosition.LEFT_BOTTOM },
    });

    infoWindow = new google.maps.InfoWindow({ maxWidth: 320 });

    const cities = new Set();

    PLACES.forEach(p => {
      if (!p.lat || !p.lng) return;
      if (p.city) cities.add(p.city);

      const marker = new google.maps.Marker({
        position: { lat: p.lat, lng: p.lng },
        map,
        title: p.name,
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 10,
          fillColor: typeColor(p.type),
          fillOpacity: 1,
          strokeColor: 'white',
          strokeWeight: 2.5,
        },
      });

      marker._city = p.city;
      marker.addListener('click', () => {
        infoWindow.setContent(buildInfoHTML(p));
        infoWindow.open(map, marker);
      });
      markers.push(marker);
    });

    // City filter buttons
    const bar = document.getElementById('filters');
    [...cities].sort().forEach(city => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.textContent = city;
      btn.onclick = () => filterCity(city);
      bar.appendChild(btn);
    });

    // Fit to all markers
    fitVisible();
  }

  function getPlatform(url) {
    if (!url) return null;
    if (url.includes('tiktok.com'))    return { name: 'TikTok',    icon: 'üéµ', color: '#010101' };
    if (url.includes('instagram.com')) return { name: 'Instagram', icon: 'üì∏', color: '#e1306c' };
    if (url.includes('reddit.com'))    return { name: 'Reddit',    icon: 'ü§ñ', color: '#ff4500' };
    if (url.includes('youtube.com') || url.includes('youtu.be'))
                                       return { name: 'YouTube',   icon: '‚ñ∂Ô∏è', color: '#ff0000' };
    return { name: 'Web', icon: 'üåê', color: '#607d8b' };
  }

  function buildInfoHTML(p) {
    const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    const platform = getPlatform(p.source_url);
    let h = '<div class="iw">';
    h += `<div class="iw-name">${esc(p.name)}</div>`;
    const typeIcon = TYPE_ICONS[p.type] || 'üìå';
    const sub = [p.category, p.city, p.area].filter(Boolean).join(' ¬∑ ');
    if (sub) h += `<div class="iw-sub">${typeIcon} ${esc(sub)}</div>`;
    else if (p.type) h += `<div class="iw-sub">${typeIcon} ${esc(p.type)}</div>`;
    if (p.what_to_do)  h += `<div class="iw-row"><b>What to try:</b> ${esc(p.what_to_do)}</div>`;
    if (p.best_for)    h += `<div class="iw-row"><b>Best for:</b> ${esc(p.best_for)}</div>`;
    if (p.price_range) h += `<div class="iw-row"><b>Price:</b> ${esc(p.price_range)}</div>`;
    if (p.notes)       h += `<div class="iw-row"><b>Notes:</b> ${esc(p.notes)}</div>`;
    if (platform && p.uploader)
      h += `<div class="iw-row"><b>Via:</b> ${platform.icon} ${platform.name} ¬∑ @${esc(p.uploader)}</div>`;
    else if (platform)
      h += `<div class="iw-row"><b>Via:</b> ${platform.icon} ${platform.name}</div>`;
    else if (p.uploader)
      h += `<div class="iw-row"><b>Via:</b> @${esc(p.uploader)}</div>`;
    h += '<div class="iw-btns">';
    // Row 1: Google Maps + Apple Maps
    h += '<div class="iw-btns-row">';
    if (p.maps_url) h += `<a href="${p.maps_url}" target="_blank" class="iw-btn iw-btn-gmaps">üìç Google Maps</a>`;
    if (p.lat && p.lng) {
      const appleUrl = `https://maps.apple.com/?q=${encodeURIComponent(p.name)}&ll=${p.lat},${p.lng}`;
      h += `<a href="${appleUrl}" target="_blank" class="iw-btn iw-btn-amaps">üçé Apple Maps</a>`;
    }
    h += '</div>';
    // Row 2: Source button labelled with platform name
    if (p.source_url && platform)
      h += `<a href="${p.source_url}" target="_blank" class="iw-btn iw-btn-source" style="background:${platform.color};color:white">${platform.icon} View on ${platform.name}</a>`;
    else if (p.source_url)
      h += `<a href="${p.source_url}" target="_blank" class="iw-btn iw-btn-source">üì± View source post</a>`;
    h += '</div></div>';
    return h;
  }

  function filterCity(city) {
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.toggle('active',
        btn.textContent === city || (city === 'all' && btn.textContent === 'All'));
    });
    markers.forEach(m => m.setVisible(city === 'all' || m._city === city));
    infoWindow.close();
    fitVisible();
  }

  function fitVisible() {
    const bounds = new google.maps.LatLngBounds();
    let n = 0;
    markers.forEach(m => { if (m.getVisible()) { bounds.extend(m.getPosition()); n++; } });
    if (n > 0) map.fitBounds(bounds, { top: 60, bottom: 80, left: 20, right: 20 });
  }

  function locateMe() {
    if (!navigator.geolocation) { alert('Geolocation not supported'); return; }
    navigator.geolocation.getCurrentPosition(pos => {
      const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      map.panTo(loc);
      map.setZoom(14);
      new google.maps.Marker({
        position: loc, map,
        title: 'You are here',
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 9,
          fillColor: '#4285F4',
          fillOpacity: 1,
          strokeColor: 'white',
          strokeWeight: 3,
        },
        zIndex: 999,
      });
    }, () => alert('Could not get location. Enable location access and use HTTPS.'));
  }
  </script>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxalv-tE2G_coEPcLLCiD6S4I9A7b_RSc&callback=initMap&loading=async"
    async defer>
  </script>
</body>
</html>